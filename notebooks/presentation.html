<!DOCTYPE html>
<html>
  <head>
    <title>withREPRODUCIBLE NOTEBOOKS</title>
    <meta charset="utf-8">
    <meta name="author" content="Elliot Murphy" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="kindlyops.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide, title-slide

# <BR>with<BR>REPRODUCIBLE NOTEBOOKS
### Elliot Murphy
### 2019/01/24 (updated: 2019-05-01)

---





class: bottom, center
background-image: url(rawpixel-633843-unsplash.jpg)
background-size: cover

# PAYOFF

.large[Presentation https://www.kindlyops.com/sira19]

This presentation is made in R Markdown, using the excellent https://github.com/yihui/xaringan package.

You can find the source to this presentation at https://github.com/kindlyops/talks/blob/master/reporter/presentation.Rmd

???

Right after lunch so you are going to start feeling sleepy.
Better start by telling you the payoff for sticking around for this talk.
If you do need to step out, or if you want to skip ahead, the slides are online, you can open them from kindlyops.com/sira19
If you grab that URL, open it on your phone or jot it down, the links I reference will easy for you to access later, and you can easily share this presentation with other people at work.

Goal of this talk is to help you get a raise this year. If you don't get a raise this year after using the things I show you, get in touch, explain, I will help you get a raise. I believe hats possible because on a big project I've worked on over the last year, everyone got a raise/promotion.

Secret goal of this talk is to make you do the thing I want you to do by promising you a raise.

And if I look into the Satir interaction model, the feeling about the feeling: Secret secret goal is to make you think I'm clever by telling you the secret goal, because I Like all humans crave your acceptance and respect.

---
class: inverse, right
background-image: url(spacex-1130894-unsplash.jpg)
background-size: cover

# Your Mission


.pull-right.left[
Try a notebook, modify it, share with one other person

Make your product export notebooks
]

???

So I promised a payoff, what do I actually want you to do when you
leave? Try out a notebook. Specifically, try it out with someone
else, the sharing and remixing aspect. If you try it on your own
it's not so good. I'm going to be giving you an example notebook
to start from with a single click.

Some of you are overachievers. I see you. make your product export notebooks. Don't lock in your customers data, any of the graphs
and reports that you make, make them exportable as notebooks. I dare you.

So the rest of this talk is some stories to try and convince you.

---
class: inverse, bottom, right
background-image: url(mael-balland-1157013-unsplash.jpg)
background-size: cover

# Easy to try

???

The reason that we are here at this conference, are learning and promoting quantitative risk techniques is because most of us have felt the pinch of needing to have better conversations about risk, to influence better decisions.

The idea at the core of this talk is that when you make it easy for people to try out any new technique, to quickly use it without installing extra software, when it is comfortable and fluid and easy to change one parameter and see the results change, they are likely to start using the techniques on their own. we are looking for lever that will increase the level of cognitive performance across multiple teams, to improve the quality of the conversation that people have before making a decision.

Techniques and tools that used to be very specialized are now cheaply available to anyone who's interested to try them out.

---

class: inverse, center
background-image: url(emma-roorda-225458-unsplash.jpg)
background-size: cover

# .large[PLAY]

???

This is something that matters not just for risk analysis, it’s about data science generally. I’d like to see the general workforce develop the ability to use quantitative risk analysis not only for cyber security risk scenarios, but for all kinds of general purpose operational risk scenarios, because it leads to a higher quality conversation and higher quality decision.

tony’s example post on LinkedIn about whether to buy insurance for a phone was fabulous because it was an example of a lightweight on-the-fly use of quantitative risk analysis for a spur of the moment scenario.

The only reason that someone can whip up a scenario like that is if it’s easy to use the techniques - when it’s easy enough for people to try these techniques in casual scenarios, in toy scenarios, they will get SO MUCH better and more confident at using them in important scenarios.

Play and experimentation is crucial to getting grassroots adoption of these techniques.

---

class: center

# LEVEL UP

???

When I think about the governance part of governance risk and compliance, I get very intereste in how the cognitive ability of groups changes over time, and how they are able to take on harder and harder challenges that no single person in the group is capable of explaining. I think a lot about tools/levers/cognitive multipliers that work on the front lines, at the edges, that are not exclusively top-down but can be used independently, divergently, experimentally, without centralized permission.

---

---

class: inverse, right
background-image: url(chris-sabor-524212-unsplash.jpg)
background-size: cover

# working&lt;br&gt;together

???


---

# Example notebooks

A notebook with some example graphs using python.&lt;br&gt;
&lt;a href="https://colab.research.google.com/github/jakevdp/PythonDataScienceHandbook/blob/master/notebooks/04.14-Visualization-With-Seaborn.ipynb"&gt;&lt;img align="left" src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" title="Open and Execute in Google Colaboratory"&gt;&lt;/a&gt;


???

This is a chapter from the Python Data Science book. It is
published on a website, and with a single click you can make your own copy and start editing in Google Colab, which is a hosted environment
for Jupyter notebooks in much the same way as Google Docs is a hosted platform for documents.
---

# docker-compose.yml simpler invocation

```yaml
version: '2'
services:
  report:
*    image: kindlyops/reporter:big-roboto
    working_dir: /docs
    volumes:
      - .:/docs
    command: [./compilereport]
```

???

So this is a little helper config file which makes it easier to run a command
inside a docker image, build/pull the docker image, mount volumes, etc.

So the way it works is this specifies a docker image, the docker image
has R, the needed R packages, any extra fonts.

The source .Rmd file and source data files are in the local directory,
docker volume mounts are used to expose the local files inside the docker
container, and the output files are written back out to the host machine.

This was worked well, but too much was hardcoded in the report.Rmd
Wanted to be able to use a template and feed in some different
data files from different projects/customers to generate customized
graphs with standard formats.

---

# compilereport utility script

```r
#!/usr/bin/env Rscript

suppressPackageStartupMessages(library("optparse"))

option_list &lt;- list(
     make_option(c("-t", "--template"), action="store", 
         default="report.Rmd", help="The file to use"),
     make_option(c("-d", "--data"), action="store",
*        default="input.csv", help="The input data file"),
     make_option(c("-o", "--output"), action="store", 
         default="output/output.pptx",
         help="The output data file to create")
     )

opt_parser = OptionParser(option_list=option_list)
options &lt;- parse_args(opt_parser)

*rmarkdown::render(options$template, output_file=options$output,
*                  params = list(data = options$data))
```

???

This is using Rscript as the shebang, and uses the optparse R package
to process command line arguments to the script. From the perspective
of the person running the command, they don't need to know that it's `R`.

Allowing the input.csv, template file, and output file to be
specified on the command line made things much more flexible.

This was work we did when connecting up the publishing pipeline
to our web application, so that we could trigger report generation
from the app and have a background worker job generate the reports
and publish them.

---

# passing parameters into R Markdown!

```yaml
---
title: "An Report"
output: 
  powerpoint_presentation:
    reference_doc: template.pptx
params: 
*   data: "input2.csv"
---
```

???

Note the params section that knitr parses when processing R Markown,
this lines up with the parameter we defined in the `compilereport` Rscript cli
---

# Dockerfile

```Dockerfile
FROM rocker/rstudio:3.4.3

RUN apt-get update \
    &amp;&amp; apt-get install -y zlib1g-dev libproj-dev xzdec gnupg \
    &amp;&amp; tlmgr init-usertree
RUN tlmgr install roboto \
    &amp;&amp; install2.r --deps=TRUE remotes \
    &amp;&amp; install2.r --deps=TRUE tinytex \
    &amp;&amp; install2.r --deps=TRUE formatR \
    &amp;&amp; install2.r --deps=TRUE tidyverse \
    &amp;&amp; installGithub.r rstudio/rmarkdown
```

We build this image and tag it, and then reference the image
from the docker-compose file. Everyone gets the same versions
of the R libraries and other components.
---

# Future plans

## stuff we want to improve

Make the Docker images smaller!

Connect to GitHub actions so that a report is compiled automatically
when new revisions are pushed to master? Really want to invoke knit
when pushing to GitHub pages branch instead of jekyll.

Experiment with interactive graphs for exploring complex data

Figuring out integration between R and Python in order to support use of Colaboratory notebooks - jupytext and reticulate

Non-CLI subprocess way of calling into R code from Go code?

Generating custom RMarkdown notebooks on the fly and exporting them to users on demand.

---
background-image: url(lines.png)
background-position: bottom -135px center
background-size: 40%
class: center, middle, final

# "everything can be beautiful"

  elliot@kindlyops.com
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();
(function(time) {
  var d2 = function(number) {
    return ('0' + number).slice(-2); // left-pad 0 to minutes/seconds
  },

  time_format = function(total) {
    var secs = Math.abs(total) / 1000;
    var h = Math.floor(secs / 3600);
    var m = Math.floor(secs % 3600 / 60);
    var s = Math.round(secs % 60);
    var res = d2(m) + ':' + d2(s);
    if (h > 0) res = h + ':' + res;
    return res;  // [hh:]mm:ss
  },

  slide_number_div = function(i) {
    return document.getElementsByClassName('remark-slide-number').item(i);
  },

  current_page_number = function(i) {
    return slide_number_div(i).firstChild.textContent;  // text "i / N"
  };

  var timer = document.createElement('span'); timer.id = 'slide-time-left';
  var time_left = time, k = slideshow.getCurrentSlideIndex(),
      last_page_number = current_page_number(k);

  setInterval(function() {
    time_left = time_left - 1000;
    timer.innerHTML = ' ' + time_format(time_left);
    if (time_left < 0) timer.style.color = 'red';
  }, 1000);

  slide_number_div(k).appendChild(timer);

  slideshow.on('showSlide', function(slide) {
    var i = slide.getSlideIndex(), n = current_page_number(i);
    // reset timer when a new slide is shown and the page number is changed
    if (last_page_number !== n) {
      time_left = time; last_page_number = n;
      timer.innerHTML = ' ' + time_format(time); timer.style.color = null;
    }
    slide_number_div(i).appendChild(timer);
  });
})(120000);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
